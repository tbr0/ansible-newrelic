---
# Generic Playbook to install and configure apache as an example
#

- name: Download New Relic yum GPG key for RHEL
  get_url: url="http://yum.newrelic.com/548C16BF.gpg" dest="/etc/pki/rpm-gpg/RPM-GPG-KEY-NewRelic" mode=0640
  when: ansible_os_family == 'RedHat'

- name: Install New Relic PHP Agent and System Monitor for RHEL
  yum: pkg={{ item }} state=installed
  with_items:
  - newrelic-php5
  - newrelic-sysmond
  when: ansible_os_family == 'RedHat'

#- name: Check for PHP installation for RHEL
#  command: rpm -q php5
#  register: rpm_php5_output

- name: Prompt for license key.
  #fail: msg="New Relic key not provided, stopping."
  #when: newrelic_license_key is not defined
  pause: prompt="Please enter your New Relic license key:"
  register: newrelic_license_key
#- debug: var=newrelic_license_key
  environment: 
    NR_INSTALL_KEY: "{{ newrelic_license_key }}"

- name: Run newrelic-install with provided license key.
  command: /usr/bin/newrelic-install install
  register: newrelic_install
- debug: var=newrelic_install

#- name: regather facts
#  setup:
#  when: ansible_os_family == 'RedHat'
#
#- name: copy httpd template - 6.x
#  template: src=RedHat/v22/httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf
#  when: ansible_os_family == 'RedHat'
#
#- name: create conf.d directory
#  file: path=/etc/httpd/vhost.d owner=root group=root mode=0755 state=directory
#  when: ansible_os_family == 'RedHat'
#
#- name: copy ports.conf template
#  template: src=ports.conf.j2 dest=/etc/httpd/ports.conf
#  when: ansible_os_family == 'RedHat'
#
#- name: Install apache2 for Debian based
#  apt: pkg=apache2 state=installed update_cache=true
#  when: ansible_os_family == 'Debian'
#
#- name: copy apache2.conf template - 12.04
#  template: src=Debian/v22/apache2.conf.j2 dest=/etc/apache2/apache2.conf
#  when: ansible_os_family == 'Debian' and ansible_lsb.release == '12.04' or ansible_lsb.major_release == '7'
#
#- name: copy apache2.conf template - 14.04
#  template: src=Debian/v24/apache2.conf.j2 dest=/etc/apache2/apache2.conf
#  when: ansible_os_family == 'Debian' and ansible_lsb.release == '14.04'
#
#- name: copy ports.conf template
#  template: src=ports.conf.j2 dest=/etc/apache2/ports.conf
#  when: ansible_os_family == 'Debian'
#
#- name: create conf.d directory
#  file: path=/etc/apache2/conf.d owner=root group=root mode=0755 state=directory
#  when: ansible_os_family == 'Debian'
